<br />neo4j 서버 구축이 되었다면 이제 java application 에서 연결하도록 해야한다.<br />spring-data project에 neo4j가 있어서 해당 spring-data 를 이용해서 neo4j DB에<br />연결해 보도록 하겠다.<br /><br /><br />spring 으로 구성된 프로젝트라고 가정하에 spring-data-neo4j<br /><br /><br />&nbsp;&lt;dependency&gt;<br />&nbsp; &nbsp; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;<br />&nbsp; &nbsp; &lt;artifactId&gt;spring-data-neo4j-rest&lt;/artifactId&gt;<br />&nbsp; &nbsp; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&nbsp; &nbsp; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;<br />&nbsp; &nbsp; &lt;artifactId&gt;spring-data-neo4j&lt;/artifactId&gt;<br />&nbsp; &nbsp; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;<br />&lt;/dependency&gt;<br /><br />추가를 해서 필요한 라이브러리를 가져옵니다.<br /><br /><br />spring 설정 xml 파일에<br /><br /><br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;beans xmlns="http://www.springframework.org/schema/beans"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xmlns:aop="http://www.springframework.org/schema/aop"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xmlns:tx="http://www.springframework.org/schema/tx"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xmlns:context="http://www.springframework.org/schema/context"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xmlns:neo4j="http://www.springframework.org/schema/data/neo4j"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>xsi:schemaLocation="<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/beans<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/beans/spring-beans-3.1.xsd<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/tx<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/tx/spring-tx-3.1.xsd<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/aop<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/aop/spring-aop-3.1.xsd<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/context<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/context/spring-context-3.1.xsd<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/data/neo4j<br />&nbsp; &nbsp; &nbsp;http://www.springframework.org/schema/data/neo4j/spring-neo4j-2.0.xsd<br />&nbsp; &nbsp; &nbsp;"&gt;<br /><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;context:annotation-config/&gt;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>&lt;neo4j:config graphDatabaseService="graphDatabaseService"/&gt;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>&lt;bean id="graphDatabaseService"<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>class="org.springframework.data.neo4j.rest.SpringRestGraphDatabase"&gt;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp;&lt;constructor-arg index="0" value="http://설치IP:7474/db/data" /&gt;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>&lt;/bean&gt;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>&lt;neo4j:repositories base-package="xx.package..dao.neo4j"/&gt;<br /><br />&lt;/beans&gt;<br /><br />추가를 해서 설치된 DB에 연결정보를 설정하도록 합니다.<br /><br />필요한 라이브러리와 spring 설정이 완료가 되면 이제<br />Repository Interface 를 통해서 neo4j DB와 연결을 하게 됩니다.<br /><br />우선 작성전에 nosql DB이므로 해당 collection(RDB의 table 과 비슷한 개념) 에<br />매칭이 되는 모델 객체가 있어야 합니다. 해당 모델 객체는 neo4j 에서 데이터 노드(node)<br />와 매칭 되는 객체가 됩니다.<br /><br /><br />neo4j노드와 매칭되는 class 를 만들어 봅니다.<br /><br /><br /><br />@NodeEntity<br />public class ContactUser {<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@GraphId<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>Long nodeId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@GraphProperty<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@Indexed<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>String userId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@GraphProperty<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>String name;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@GraphProperty<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>String email;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@GraphProperty<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>String telephone;<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@RelatedToVia<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>Collection&lt;Connection&gt; connections;<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public String getUserId() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return userId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setUserId(String userId) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>this.userId = userId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public String getName() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return name;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setName(String name) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>this.name = name;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public String getEmail() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return email;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setEmail(String email) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>this.email = email;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public String getTelephone() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return telephone;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setTelephone(String telephone) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>this.telephone = telephone;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public Long getNodeId() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return nodeId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public void setNodeId(Long nodeId) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>this.nodeId = nodeId;<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@Override<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public String toString() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return String.format("%s (%s) [%s]", nodeId, userId, name);<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@Override<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public boolean equals(Object o) {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>if (this == o)<br /><span class="Apple-tab-span" style="white-space: pre;">   </span>return true;<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>if (o == null || getClass() != o.getClass())<br /><span class="Apple-tab-span" style="white-space: pre;">   </span>return false;<br /><br /><span class="Apple-tab-span" style="white-space: pre;">  </span>ContactUser contactUser = (ContactUser)o;<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>if (nodeId == null)<br /><span class="Apple-tab-span" style="white-space: pre;">   </span>return super.equals(o);<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return nodeId.equals(contactUser.nodeId);<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br /><span class="Apple-tab-span" style="white-space: pre;"> </span>@Override<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>public int hashCode() {<br /><span class="Apple-tab-span" style="white-space: pre;">  </span>return nodeId != null ? nodeId.hashCode() : super.hashCode();<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>}<br /><br />}<br /><br /><br /><br />해당 contactUser 라는 모델의 데이터로 neo4j 에 노드(node) 로 매칭되어서<br />저장이 됩니다. 해당 Class 에 어노테이션을 주로 보셔야 합니다.<br /><br />@NodeEntity -&gt; 해당 Class 가 Node Entity 임을 표현합니다.<br />@GraphId -&gt; 해당 노드(node) 의 Key 가 됩니다. neo4j 에서 생성 해줍니다.<br />@GraphProperty -&gt; 필드가 Property 임을 표현합니다.<br />@Indexed -&gt; 노드(node)에서의 index 를 표현합니다.<br /><br />이렇게 노드(node)에 매칭되는 모델 객체를 만들었으면 이제 Repository Interface를<br />사용하시면 됩니다.<br /><br /><br /><br /><br />public interface ContactUserRepository extends GraphRepository&lt;ContactUser&gt;, NamedIndexRepository&lt;ContactUser&gt;, RelationshipOperationsRepository&lt;ContactUser&gt; {<br /><br />}<br /><br />ContactUser 에 대한 GraphRepositry Interface를 기본으로 CURD를 그냥 사용할수 있습니다.<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />