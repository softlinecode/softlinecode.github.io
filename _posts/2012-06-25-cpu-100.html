---
layout: post
title: 이메일 체크 정규식 복잡도 상승으로 cpu 100% 문제
date: '2012-06-24T20:42:00.008-07:00'
author: Jung Gi Lim
tags:
- 정규식
- Java
modified_time: '2012-06-24T20:42:56.760-07:00'
blogger_id: tag:blogger.com,1999:blog-2993388283610032812.post-2785918123062468262
blogger_orig_url: http://softline21c.blogspot.com/2012/06/cpu-100.html
---

<br /><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;">이메일등 특정한 패턴을 가지는 문자열 체크에 주로 정규식을 사용해서 체크를 한다.</div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;">특정한 문자열에 대한 정규식이 복잡도가 엄청나게 올라가게면 cpu 를 100%까지 사용하면서 오랜시간 수행되는 문제가 발생하였다.</div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><br /></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;">&nbsp; String regex = "^[_a-zA-Z0-9-]+(.[_a-zA-Z0-9-]+)*@(?:\\w+\\.)+\\w+$";<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;Pattern pattern = Pattern.compile(regex);<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;Matcher matcher = pattern.matcher(email);<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;if (!matcher.matches()) {<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;&nbsp;return false;<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;} else {<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;&nbsp;return true;<br style="margin: 0px; padding: 0px;" />&nbsp;&nbsp;}</div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><br /></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;">해당 함수는 이메일을 체크하는 정규식인데&nbsp;<span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;">12345678901234567890123456789012345678901234567890</span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><span style="color: black; font-family: 돋움; font-size: x-small;">이런 문자가 들어올 경우 문제가 된다. 인터넷을 검색하다가 해당 문제가 발생하지 않을 것으로</span></span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><span style="font-family: 돋움;"><span style="color: black; font-size: x-small;">보이는 정규식이 정리된 곳을 찾게&nbsp; 되었다.</span></span></span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><br /></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><a class="con_link" href="http://www.regular-expressions.info/email.htm" target="_blank">http://www.regular-expressions.info/email.htm</a></span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><br /></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; color: black; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px;"><span style="font-family: 돋움;"><span style="color: black; font-size: x-small;">해당 문제의 경우 쉽게 예상되지 않고 찾기가 매우 어렵다. 서버 cpu가 갑자기 상승할때</span></span></span></span></span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; color: black; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px;"><span style="color: black; font-family: 돋움; font-size: x-small;">thread dump 를 생성하고 그 dump 분석해서 찾게 되었다.</span></span></span></span></span></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><br /></div><div style="font-family: 돋움, Dotum, AppleGothic, sans-serif; font-size: 12px; line-height: 18px; padding: 0px;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small; line-height: normal;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px; text-align: left;"><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px; color: black; font-family: 돋움, Dotum, 굴림, Gulim, AppleGothic, sans-serif; font-size: small;"><span class="Apple-style-span" style="color: #444444; font-family: 나눔고딕, AppleGothic, sans-serif; font-size: 13px;"><span style="font-family: 돋움;"><span style="color: black; font-size: x-small;">정규식을 작성할때 꼭 고려해봐야겠다.</span></span></span></span></span></span></div>