---
layout: post
title: '[Spring 3.2] Spring MVC  ContentNegotiatingViewResolver'
date: '2013-08-12T05:59:00.000-07:00'
author: Jung Gi Lim
tags:
- spring
- Spring MVC
modified_time: '2013-08-12T05:59:01.815-07:00'
blogger_id: tag:blogger.com,1999:blog-2993388283610032812.post-5703437374694590609
blogger_orig_url: http://softline21c.blogspot.com/2013/08/spring-32-spring-mvc.html
---

동일한 Controller 를 사용하지만 view 타입(결과 형식)이 다르게 사용해야 하는 경우가 있다.<br />아마 동일한 로직(Controller)를 web(UI) 나 API 에서 동시에 사용하고 싶을때가 있다.<br />이런 경우 사용하면 아주 유용한 Resolver 이다.<br /><br />동일한 Controller 를 일반 Web Ui (jsp) , json 형식으로 받는 것을 보도록 하겠다.<br /><br /><pre class="brush:xml"><br /><?xml version="1.0" encoding="UTF-8"?><br /><beans xmlns="http://www.springframework.org/schema/beans"<br /> xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"<br /> xmlns:context="http://www.springframework.org/schema/context"<br /> xsi:schemaLocation="<br />  http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd<br />  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd<br />  http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd<br /> "><br /><br /> <!-- mvc 관련 annotation --><br /> <mvc:annotation-driven><br />  <mvc:argument-resolvers><br />   <bean class="com.softline.study.interceptor.UserHandlerMethodArgumentResolver"></bean>  <br />  </mvc:argument-resolvers><br /> </mvc:annotation-driven><br /><br /> <!-- component scan 패키지 등록 stereotype 타입 scan --><br /> <context:component-scan base-package="com.softline.study" /><br /> <br /> <bean<br />  class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver"><br />  <property name="order" value="1"/><br />  <property name="contentNegotiationManager"><br />   <bean class="org.springframework.web.accept.ContentNegotiationManager"><br />    <constructor-arg>     <bean<br />      class="org.springframework.web.accept.PathExtensionContentNegotiationStrategy"><br />      <constructor-arg>       <map><br />        <entry key="json" value="application/json" /><br />       </map><br />      </constructor-arg>     </bean><br /><br />    </constructor-arg>   </bean><br /><br />  </property><br /><br />  <property name="defaultViews"><br /><br />   <list><br /><br />    <bean<br />     class="org.springframework.web.servlet.view.json.MappingJacksonJsonView" /><br /><br />   </list><br /><br />  </property><br /><br /> </bean><br /><br /><br /><br /> <!-- ViewResolver --><br /><br /> <bean<br />  class="org.springframework.web.servlet.view.InternalResourceViewResolver"><br /><br />  <property name="order" value="2" /><br /><br />  <property name="prefix"><br /><br />   <value>/WEB-INF/view/jsp/</value><br /><br />  </property><br /><br />  <property name="suffix"><br /><br />   <value>.jsp</value><br /><br />  </property><br /><br /> </bean><br /><br /></beans><br /><br /><br /><br /></pre><br />ContentNegotiatingViewResolver 를 사용해서 우선 json 인 경우 처리하는 방식을 정의 하였다. <br />PathExtensionContentNegotiationStrategy 를 이용해서 url의 확장명이 json 인 경우 json 형식으로 view resolver를 사용한다.<br /><br />기본 ViewResolver는 기존 방식(JSP)이 선언되어져 있으면 ContentNegotiatingViewResolver 에 설정된 path가 없는 경우 기본 view resolver를 사용하게 된다.<br />json 형식처럼 여기에 xml 이나 다른 방식을 추가해서 사용할수도 있다.<br /><br /><pre class="brush:java">package com.softline.study.controller;<br /><br />import org.springframework.stereotype.Controller;<br />import org.springframework.web.bind.annotation.RequestMapping;<br />import org.springframework.web.servlet.ModelAndView;<br /><br />import com.softline.study.model.User;<br /><br />@Controller<br />@RequestMapping("view")<br />public class ContentNegotiatingViewResolverTestController {<br /> <br /> @RequestMapping(value = {"/view" , "view.json"})<br /> public ModelAndView viewResolverTest(User user){<br />  ModelAndView modelAndView = new ModelAndView("test");<br />  modelAndView.addObject("name", user.getName() );<br />  return modelAndView;<br /> }<br />}<br /></pre><br />이렇게 controller 에 view , view.json 두개의 url 형식을 받게 되고 동일한 로직이지만 .json이 붙게 되면<br />결과 값이 json으로 오게 됩니다.<br />Json 결과<br /><pre class="brush:text">{"name":"테스트"}<br /></pre>Jsp 결과<br /><pre class="brush:html">테스트<br /></pre><br /><br /><br />